{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\fronttimeline\\\\src\\\\containers\\\\Base\\\\PostListContainer.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport PageWrapper from '../../components/PageWrapper';\nimport { FeedList } from '../../components/PostList';\nimport { bindActionCreators } from 'redux';\nimport * as friendActions from '../../redux/modules/friend';\nimport * as postActions from '../../redux/modules/post';\nimport * as timelineActions from '../../redux/modules/timeline';\nimport * as searchActions from '../../redux/modules/search';\nimport * as likeActions from '../../redux/modules/like';\nimport * as commentActions from '../../redux/modules/comment';\nimport storage from '../../lib/storage';\n\nclass PostListContainer extends Component {\n  constructor(...args) {\n    super(...args);\n\n    this.openWriteModal = () => {\n      this.props.PostActions.setWriteDisplay('block');\n    };\n\n    this.handleScroll = async e => {\n      const scrollTop = e.srcElement.scrollingElement.scrollTop;\n      const _window = window,\n            innerHeight = _window.innerHeight;\n      const scrollHeight = document.body.scrollHeight;\n\n      if (scrollTop + innerHeight > scrollHeight & this.props.isTruePost) {\n        this.getFeedList();\n        await this.props.TimelineActions.addPage();\n      }\n    };\n\n    this.componentDidMount = async () => {\n      window.addEventListener(\"scroll\", this.handleScroll);\n      if (!storage.get('loggedInfo')) return;\n      await this.props.PostActions.setWrittenData(storage.get('loggedInfo').nickname + '님 무슨 일이 있으셨나요?');\n      await this.getFeedList();\n      await this.props.TimelineActions.addPage();\n    };\n\n    this.getFeedList = async () => {\n      const _this$props = this.props,\n            TimelineActions = _this$props.TimelineActions,\n            page = _this$props.page,\n            isTruePost = _this$props.isTruePost;\n\n      if (isTruePost) {\n        try {\n          await TimelineActions.getMainInformation(page);\n          await this.setPostTime();\n        } catch (e) {\n          await TimelineActions.setFalsePost();\n        }\n      }\n    };\n\n    this.setPostTime = async () => {\n      const _this$props2 = this.props,\n            data = _this$props2.data,\n            TimelineActions = _this$props2.TimelineActions;\n      await Promise.all(data.map(async (feed, index) => {\n        let time = feed.getIn(['feed', 'timestamp']);\n        let timestring = this.dateTimeToFormatted(time);\n        await TimelineActions.setTime({\n          timestring: timestring,\n          index: index\n        });\n      }));\n    };\n\n    this.setCommentTime = async id => {\n      const _this$props3 = this.props,\n            data = _this$props3.data,\n            TimelineActions = _this$props3.TimelineActions;\n      let index = data.findIndex(item => item.getIn(['feed', 'postId']) === parseInt(id));\n      const comments = data.getIn([index, 'feed', 'commentList']);\n      await Promise.all(comments.map(async (comment, commentIndex) => {\n        console.log(comment.timestamp);\n        let time = comment.timestamp;\n        let timestring = this.dateTimeToFormatted(time);\n        await TimelineActions.setCommentTime({\n          timestring: timestring,\n          index: index,\n          commentIndex: commentIndex\n        });\n      }));\n    };\n\n    this.overHashTag = e => {\n      const TimelineActions = this.props.TimelineActions;\n      TimelineActions.setHashDisplay('block');\n      TimelineActions.setKey(e.target.id);\n      TimelineActions.setCategoryId(e.target.dataset.category);\n    };\n\n    this.outHashTag = e => {\n      const TimelineActions = this.props.TimelineActions;\n      TimelineActions.setHashDisplay('none');\n    };\n\n    this.handleStateClick = e => {\n      window.location.href = `/@:${e.target.id}`;\n    };\n\n    this.handleLikeClick = async e => {\n      const _this$props4 = this.props,\n            LikeActions = _this$props4.LikeActions,\n            TimelineActions = _this$props4.TimelineActions;\n      const id = e.target.id;\n      await TimelineActions.setLikeKey(id);\n      await LikeActions.clickLike(id);\n      await TimelineActions.setLike('none');\n\n      try {\n        await LikeActions.getLikeAndUserList(id, 1);\n      } catch (e) {}\n\n      const totalNum = this.props.totalNum;\n      await TimelineActions.setLikeNum(totalNum);\n    };\n\n    this.dateTimeToFormatted = dt => {\n      const min = 60 * 1000;\n      const c = new Date();\n      var d = new Date(dt);\n      var minsAgo = Math.floor((c - d) / min);\n      var result = {\n        'raw': d.getFullYear() + '-' + (d.getMonth() + 1 > 9 ? '' : '0') + (d.getMonth() + 1) + '-' + (d.getDate() > 9 ? '' : '0') + d.getDate() + ' ' + (d.getHours() > 9 ? '' : '0') + d.getHours() + ':' + (d.getMinutes() > 9 ? '' : '0') + d.getMinutes() + ':' + (d.getSeconds() > 9 ? '' : '0') + d.getSeconds(),\n        'month': d.getFullYear() + '-' + (d.getMonth() + 1 > 9 ? '' : '0') + (d.getMonth() + 1) + '-' + (d.getDate() > 9 ? '' : '0') + d.getDate(),\n        'formatted': ''\n      };\n\n      if (minsAgo < 60) {\n        // 1시간 내\n        result.formatted = minsAgo + '분 전';\n      } else if (minsAgo < 60 * 24) {\n        // 하루 내\n        result.formatted = Math.floor(minsAgo / 60) + '시간 전';\n      } else if (minsAgo < 60 * 24 * 30) {\n        // 하루 이상\n        result.formatted = Math.floor(minsAgo / 60 / 24) + '일 전';\n      } else {\n        result.formatted = result.month;\n      }\n\n      return result.formatted;\n    };\n\n    this.handleCancelClick = async e => {\n      const _this$props5 = this.props,\n            LikeActions = _this$props5.LikeActions,\n            TimelineActions = _this$props5.TimelineActions;\n      const id = e.target.id;\n      await TimelineActions.setLikeKey(id);\n      await LikeActions.cancelLike(id);\n      await TimelineActions.setLike('block');\n\n      try {\n        await LikeActions.getLikeAndUserList(id, 1);\n      } catch (e) {}\n\n      const totalNum = this.props.totalNum;\n      await TimelineActions.setLikeNum(totalNum);\n    };\n\n    this.handleComment = async e => {\n      const _this$props6 = this.props,\n            CommentActions = _this$props6.CommentActions,\n            TimelineActions = _this$props6.TimelineActions,\n            data = _this$props6.data;\n      const id = e.target.id;\n      const category = e.target.dataset.category;\n      await TimelineActions.setCommentCategory(category);\n      await TimelineActions.setCommentDisplay(id);\n      const commentdisplay = this.props.commentdisplay;\n\n      if (commentdisplay === 'block') {\n        let index = data.findIndex(item => item.getIn(['feed', 'postId']) === parseInt(id));\n        let page = data.getIn([index, 'feed', 'commentPage']);\n        await CommentActions.showPostCommentList(id, page);\n        await TimelineActions.setCommentPage(id);\n        const _this$props7 = this.props,\n              commentList = _this$props7.commentList,\n              lastComment = _this$props7.lastComment;\n        if (lastComment) await TimelineActions.setCommentList({\n          'commentId': id,\n          'commentList': commentList,\n          'trueComment': false\n        });else await TimelineActions.setCommentList({\n          'commentId': id,\n          'commentList': commentList,\n          'trueComment': true\n        });\n        await this.setCommentTime(id);\n      }\n    };\n\n    this.handleCommentAdd = async e => {\n      const id = e.target.id;\n      const _this$props8 = this.props,\n            TimelineActions = _this$props8.TimelineActions,\n            CommentActions = _this$props8.CommentActions,\n            data = _this$props8.data;\n      const index = data.findIndex(item => item.getIn(['feed', 'postId']) === parseInt(id));\n\n      if (data.getIn([index, 'feed', 'trueComment'])) {\n        const page = data.getIn([index, 'feed', 'commentPage']);\n\n        try {\n          await CommentActions.showPostCommentList(id, page);\n          await TimelineActions.setCommentPage(id);\n          const _this$props9 = this.props,\n                commentList = _this$props9.commentList,\n                lastComment = _this$props9.lastComment;\n          if (lastComment) await TimelineActions.setCommentList({\n            'commentId': id,\n            'commentList': commentList,\n            'trueComment': false\n          });else await TimelineActions.setCommentList({\n            'commentId': id,\n            'commentList': commentList,\n            'trueComment': true\n          });\n          await this.setCommentTime(id);\n        } catch (e) {\n          TimelineActions.setCommentFalse(id);\n        }\n      }\n    };\n\n    this.enterComment = async e => {\n      if (window.event.keyCode === 13) {\n        const _this$props10 = this.props,\n              CommentActions = _this$props10.CommentActions,\n              TimelineActions = _this$props10.TimelineActions;\n        const _e$target = e.target,\n              innerText = _e$target.innerText,\n              id = _e$target.id;\n        console.log(id);\n        var content = innerText;\n        content = content.replace(/\\r/g, \"\");\n        content = content.replace(/\\n/g, \"\");\n        await CommentActions.writeComment({\n          id,\n          content\n        });\n        await CommentActions.showPostCommentList(id, 1);\n        this.renewComment(id);\n\n        for (var i = 0; i < document.getElementsByName('^^comment').length; i++) {\n          if (parseInt(document.getElementsByName('^^comment')[i].id) === parseInt(id)) {\n            document.getElementsByName('^^comment')[i].textContent = '';\n            document.getElementsByName('^^comment')[i].blur();\n          }\n        }\n\n        await CommentActions.getCommentNum(id);\n        var commentNum = this.props.commentNum;\n        await TimelineActions.setCommentNum({\n          'commentNum': commentNum,\n          'commentId': id\n        });\n        await this.setCommentTime(id);\n      }\n    };\n\n    this.renewComment = id => setTimeout(async () => {\n      const _this$props11 = this.props,\n            presentComment = _this$props11.presentComment,\n            TimelineActions = _this$props11.TimelineActions;\n      await TimelineActions.renewComment({\n        'commentId': id,\n        'presentComment': presentComment\n      });\n      await this.setCommentTime(id);\n    }, 2000);\n\n    this.handleImage = e => {\n      const id = e.target.id;\n      const imageid = e.target.dataset.imageid;\n      this.props.history.push(`/feed/@:${id}/image/:${imageid}`);\n    };\n  }\n\n  getSnapshotBeforeUpdate(prevProps, prevState) {\n    return prevProps.data !== this.props.data;\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    if (snapshot) {\n      this.setPostTime();\n    }\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return this.props.data !== nextProps.data || this.props.writtenData !== nextProps.writtenData || this.props.hashdisplay !== nextProps.hashdisplay;\n  }\n\n  render() {\n    const data = this.props.data;\n    const style = {\n      lineHeight: '160%'\n    };\n\n    if (!storage.get('loggedInfo')) {\n      return null;\n    }\n\n    const username = storage.get('loggedInfo').nickname;\n    const thumbnail = storage.get('loggedInfo').thumbnail;\n    const _this$props12 = this.props,\n          writtenData = _this$props12.writtenData,\n          hashdisplay = _this$props12.hashdisplay,\n          keyid = _this$props12.keyid,\n          category = _this$props12.category,\n          totalNum = _this$props12.totalNum,\n          commentCategory = _this$props12.commentCategory,\n          PostActions = _this$props12.PostActions;\n    const openWriteModal = this.openWriteModal,\n          overHashTag = this.overHashTag,\n          outHashTag = this.outHashTag,\n          handleStateClick = this.handleStateClick,\n          handleLikeClick = this.handleLikeClick,\n          enterComment = this.enterComment,\n          handleCommentAdd = this.handleCommentAdd,\n          handleCancelClick = this.handleCancelClick,\n          handleComment = this.handleComment,\n          handleImage = this.handleImage;\n    if (writtenData === '') PostActions.setWrittenData(`${username}님, 무슨 일이 있으셨나요?`);\n    return React.createElement(PageWrapper, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    }, React.createElement(FeedList, {\n      mainfeed: data,\n      username: username,\n      onclick: openWriteModal,\n      stateclick: handleStateClick,\n      content: writtenData.split('\\n').map((line, index) => {\n        return React.createElement(\"div\", {\n          key: index,\n          style: style,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 253\n          },\n          __self: this\n        }, line, React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 253\n          },\n          __self: this\n        }));\n      }),\n      hover: overHashTag,\n      nothover: outHashTag,\n      hashdisplay: hashdisplay,\n      keyid: keyid,\n      like: handleLikeClick,\n      category: category,\n      cancel: handleCancelClick,\n      totalNum: totalNum,\n      handleComment: handleComment,\n      handleCommentAdd: handleCommentAdd,\n      thumbnail: thumbnail,\n      commentCategory: commentCategory,\n      enterComment: enterComment,\n      handleImage: handleImage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default connect(state => ({\n  writtenData: state.post.get('writtenData'),\n  data: state.timeline.get('mainfeed'),\n  page: state.timeline.get('page'),\n  isTruePost: state.timeline.get('isTruePost'),\n  hashdisplay: state.timeline.get('hashdisplay'),\n  keyid: state.timeline.get('keyid'),\n  category: state.timeline.get('categoryid'),\n  totalNum: state.like.get('totalNum'),\n  commentList: state.comment.get('commentList'),\n  commentNum: state.comment.get('commentNum'),\n  commentCategory: state.timeline.get('commentCategory'),\n  commentdisplay: state.timeline.get('commentdisplay'),\n  postId: state.post.get('postId'),\n  presentComment: state.comment.get('presentComment'),\n  lastComment: state.comment.get('lastComment')\n}), dispatch => ({\n  TimelineActions: bindActionCreators(timelineActions, dispatch),\n  FriendActions: bindActionCreators(friendActions, dispatch),\n  SearchActions: bindActionCreators(searchActions, dispatch),\n  PostActions: bindActionCreators(postActions, dispatch),\n  LikeActions: bindActionCreators(likeActions, dispatch),\n  CommentActions: bindActionCreators(commentActions, dispatch)\n}))(PostListContainer);","map":{"version":3,"sources":["C:/Users/user/fronttimeline/src/containers/Base/PostListContainer.js"],"names":["React","Component","connect","PageWrapper","FeedList","bindActionCreators","friendActions","postActions","timelineActions","searchActions","likeActions","commentActions","storage","PostListContainer","openWriteModal","props","PostActions","setWriteDisplay","handleScroll","e","scrollTop","srcElement","scrollingElement","window","innerHeight","scrollHeight","document","body","isTruePost","getFeedList","TimelineActions","addPage","componentDidMount","addEventListener","get","setWrittenData","nickname","page","getMainInformation","setPostTime","setFalsePost","data","Promise","all","map","feed","index","time","getIn","timestring","dateTimeToFormatted","setTime","setCommentTime","id","findIndex","item","parseInt","comments","comment","commentIndex","console","log","timestamp","overHashTag","setHashDisplay","setKey","target","setCategoryId","dataset","category","outHashTag","handleStateClick","location","href","handleLikeClick","LikeActions","setLikeKey","clickLike","setLike","getLikeAndUserList","totalNum","setLikeNum","dt","min","c","Date","d","minsAgo","Math","floor","result","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","formatted","month","handleCancelClick","cancelLike","handleComment","CommentActions","setCommentCategory","setCommentDisplay","commentdisplay","showPostCommentList","setCommentPage","commentList","lastComment","setCommentList","handleCommentAdd","setCommentFalse","enterComment","event","keyCode","innerText","content","replace","writeComment","renewComment","i","getElementsByName","length","textContent","blur","getCommentNum","commentNum","setCommentNum","setTimeout","presentComment","handleImage","imageid","history","push","getSnapshotBeforeUpdate","prevProps","prevState","componentDidUpdate","snapshot","shouldComponentUpdate","nextProps","nextState","writtenData","hashdisplay","render","style","lineHeight","username","thumbnail","keyid","commentCategory","split","line","state","post","timeline","like","postId","dispatch","FriendActions","SearchActions"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport PageWrapper from '../../components/PageWrapper';\r\nimport {FeedList} from '../../components/PostList';\r\nimport {bindActionCreators} from 'redux';\r\nimport * as friendActions from '../../redux/modules/friend';\r\nimport * as postActions from '../../redux/modules/post';\r\nimport * as timelineActions from '../../redux/modules/timeline';\r\nimport * as searchActions from '../../redux/modules/search';\r\nimport * as likeActions from '../../redux/modules/like';\r\nimport * as commentActions from '../../redux/modules/comment';\r\nimport storage from '../../lib/storage';\r\nclass PostListContainer extends Component{\r\n    openWriteModal = () => {\r\n        this.props.PostActions.setWriteDisplay('block');\r\n    }\r\n    handleScroll = async(e) => {\r\n        const scrollTop =e.srcElement.scrollingElement.scrollTop;\r\n        const { innerHeight } = window;\r\n      const { scrollHeight } = document.body;\r\n    \r\n      if (scrollTop+innerHeight >scrollHeight & this.props.isTruePost) {\r\n        this.getFeedList();\r\n        await this.props.TimelineActions.addPage();\r\n        }\r\n    }\r\n    componentDidMount= async() =>{\r\n        window.addEventListener(\"scroll\", this.handleScroll);\r\n        if(!storage.get('loggedInfo')) return ;\r\n        await this.props.PostActions.setWrittenData(storage.get('loggedInfo').nickname + '님 무슨 일이 있으셨나요?');\r\n         await this.getFeedList();\r\n        await this.props.TimelineActions.addPage();\r\n      }\r\n\r\n      getFeedList = async() => {\r\n        const{TimelineActions,page,isTruePost} = this.props;\r\n        if(isTruePost){\r\n            try{\r\n                await TimelineActions.getMainInformation(page);\r\n                await this.setPostTime();\r\n            }catch(e){\r\n                await TimelineActions.setFalsePost();\r\n            }\r\n            \r\n        }\r\n    }\r\n    setPostTime = async() => {\r\n        const{data,TimelineActions} = this.props;\r\n                await Promise.all(\r\n                    data.map(\r\n                        async(feed,index) => {\r\n                            let time = feed.getIn(['feed','timestamp']);\r\n                            let timestring = this.dateTimeToFormatted(time);\r\n                            await TimelineActions.setTime({timestring:timestring,index : index});\r\n                        }\r\n                    )\r\n                );\r\n    }\r\n\r\n    setCommentTime = async(id) => {\r\n        const{data,TimelineActions} = this.props;\r\n        let index = data.findIndex(item => item.getIn(['feed','postId'])===parseInt(id));\r\n        const comments = data.getIn([index,'feed','commentList']);\r\n                await Promise.all(\r\n                    comments.map(\r\n                        async(comment,commentIndex) => {\r\n                            console.log(comment.timestamp);\r\n                            let time = comment.timestamp;\r\n                            let timestring = this.dateTimeToFormatted(time);\r\n                            await TimelineActions.setCommentTime({timestring:timestring,index : index,commentIndex:commentIndex});\r\n                        }\r\n                    )\r\n                );\r\n    }\r\n    \r\n    overHashTag = (e) =>{\r\n        const {TimelineActions} = this.props;\r\n        TimelineActions.setHashDisplay('block');\r\n        TimelineActions.setKey(e.target.id);\r\n        TimelineActions.setCategoryId(e.target.dataset.category);\r\n    }\r\n    outHashTag = (e) =>{\r\n        const {TimelineActions} = this.props;\r\n        TimelineActions.setHashDisplay('none');\r\n          \r\n    }\r\n    handleStateClick = (e) =>{\r\n        window.location.href =`/@:${e.target.id}`;\r\n    }\r\n    handleLikeClick = async(e) =>{\r\n        const {LikeActions,TimelineActions} = this.props;\r\n        const id = e.target.id;\r\n        await TimelineActions.setLikeKey(id);\r\n        await LikeActions.clickLike(id);\r\n        await TimelineActions.setLike('none');\r\n        try{\r\n        await LikeActions.getLikeAndUserList(id,1);\r\n        }catch(e){}\r\n        const {totalNum} = this.props;\r\n        await TimelineActions.setLikeNum(totalNum);\r\n           \r\n    }\r\n     dateTimeToFormatted=(dt)=> {\r\n\t\tconst min = 60 * 1000;\r\n\t\tconst c = new Date();\r\n\t\tvar d = new Date(dt);\r\n\t\tvar minsAgo = Math.floor((c - d) / (min));\r\n\r\n\t\tvar result = {\r\n            'raw': d.getFullYear() + '-' + (d.getMonth() + 1 > 9 ? '' : '0') + (d.getMonth() + 1) \r\n            + '-' + (d.getDate() > 9 ? '' : '0') +  d.getDate() + ' ' + (d.getHours() > 9 ? '' : '0') \r\n            +  d.getHours() + ':' + (d.getMinutes() > 9 ? '' : '0') +  d.getMinutes() + ':'  \r\n            + (d.getSeconds() > 9 ? '' : '0') +  d.getSeconds(),\r\n            'month' : d.getFullYear() + '-' + (d.getMonth() + 1 > 9 ? '' : '0') + (d.getMonth() + 1) \r\n            + '-' + (d.getDate() > 9 ? '' : '0') +  d.getDate(),\r\n\t\t\t'formatted': ''\r\n\t\t};\r\n\r\n\t\tif (minsAgo < 60) { // 1시간 내\r\n\t\t\tresult.formatted = minsAgo + '분 전';\r\n\t\t} else if (minsAgo < 60 * 24) { // 하루 내\r\n\t\t\tresult.formatted = Math.floor(minsAgo / 60) + '시간 전';\r\n\t\t} else if(minsAgo < 60 * 24 * 30) { // 하루 이상\r\n\t\t\tresult.formatted = Math.floor(minsAgo / 60 / 24) + '일 전';\r\n\t\t} else{\r\n            result.formatted = result.month;\r\n        }\r\n\t\treturn result.formatted;\r\n\t};\r\n    handleCancelClick =async(e) => {\r\n        const {LikeActions,TimelineActions} = this.props;\r\n        const id = e.target.id;\r\n        await TimelineActions.setLikeKey(id);\r\n        await LikeActions.cancelLike(id);\r\n        await TimelineActions.setLike('block');\r\n        try{\r\n        await LikeActions.getLikeAndUserList(id,1);\r\n        }catch(e){}\r\n        const {totalNum} = this.props;\r\n        await TimelineActions.setLikeNum(totalNum);\r\n    }\r\n    handleComment =async(e)=>{\r\n        const {CommentActions,TimelineActions,data} = this.props;\r\n        const {id} = e.target;\r\n        const {category} = e.target.dataset;\r\n        await TimelineActions.setCommentCategory(category);\r\n        await TimelineActions.setCommentDisplay(id);\r\n        const{commentdisplay} = this.props;\r\n        if(commentdisplay === 'block'){\r\n            let index = data.findIndex(item => item.getIn(['feed','postId'])===parseInt(id));\r\n            let page = data.getIn([index,'feed','commentPage']);\r\n            await CommentActions.showPostCommentList(id,page);\r\n            await TimelineActions.setCommentPage(id);\r\n            const{commentList,lastComment}=this.props;\r\n            if(lastComment)\r\n            await TimelineActions.setCommentList({'commentId' : id,'commentList':commentList,'trueComment' :false});\r\n            else\r\n            await TimelineActions.setCommentList({'commentId' : id,'commentList':commentList,'trueComment' :true});\r\n            await this.setCommentTime(id);\r\n        }\r\n    }\r\n\r\n    getSnapshotBeforeUpdate(prevProps, prevState) {\r\n        return prevProps.data !== this.props.data;\r\n    }\r\n   componentDidUpdate(prevProps, prevState, snapshot){\r\n        if(snapshot){\r\n            this.setPostTime();\r\n        }\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState) {\r\n        return this.props.data !== nextProps.data || this.props.writtenData !== nextProps.writtenData ||\r\n        this.props.hashdisplay !== nextProps.hashdisplay;\r\n    }\r\n    handleCommentAdd = async(e) =>{\r\n        const {id} = e.target;\r\n        const {TimelineActions,CommentActions,data} = this.props;\r\n        const index = data.findIndex(item => item.getIn(['feed','postId']) ===parseInt(id));\r\n        if(data.getIn([index,'feed','trueComment'])){\r\n            \r\n            const page = data.getIn([index,'feed','commentPage']);\r\n            try{\r\n                await CommentActions.showPostCommentList(id,page);\r\n                await TimelineActions.setCommentPage(id);\r\n                const{commentList,lastComment}=this.props;\r\n            if(lastComment)\r\n            await TimelineActions.setCommentList({'commentId':id,'commentList':commentList,'trueComment' :false});\r\n            else\r\n            await TimelineActions.setCommentList({'commentId':id,'commentList':commentList,'trueComment' :true});\r\n            await this.setCommentTime(id);\r\n            }catch(e){\r\n                TimelineActions.setCommentFalse(id);\r\n            }\r\n        } \r\n    }\r\n    enterComment = async(e) =>{\r\n        if(window.event.keyCode === 13){\r\n            const {CommentActions,TimelineActions} = this.props;\r\n            const {innerText,id} = e.target;\r\n            console.log(id);\r\n            var content = innerText;\r\n            content = content.replace(/\\r/g, \"\");\r\n            content = content.replace(/\\n/g, \"\");\r\n            await CommentActions.writeComment({id,content});\r\n            await CommentActions.showPostCommentList(id,1);\r\n            this.renewComment(id);\r\n            for(var i = 0; i < document.getElementsByName('^^comment').length; i++){\r\n                if(parseInt(document.getElementsByName('^^comment')[i].id) === parseInt(id)){\r\n                    document.getElementsByName('^^comment')[i].textContent = '';\r\n                    document.getElementsByName('^^comment')[i].blur();\r\n                }\r\n            }\r\n            await CommentActions.getCommentNum(id);\r\n            var {commentNum} = this.props;\r\n            await TimelineActions.setCommentNum({'commentNum':commentNum,'commentId':id});\r\n            await this.setCommentTime(id);\r\n            \r\n        }\r\n    }\r\n    renewComment=(id)=>\r\n        setTimeout(async()=>{\r\n            const {presentComment,TimelineActions} = this.props;\r\n            await TimelineActions.renewComment({'commentId' : id,'presentComment':presentComment});\r\n            await this.setCommentTime(id);\r\n        },2000);\r\n\r\n    handleImage =(e) =>{\r\n        const {id} = e.target;\r\n        const {imageid} = e.target.dataset;\r\n        this.props.history.push(`/feed/@:${id}/image/:${imageid}`);\r\n    }\r\n    render(){\r\n        \r\n        const {data} = this.props;\r\n        const style = {\r\n            lineHeight: '160%'\r\n        };\r\n        if(!storage.get('loggedInfo')) {\r\n            \r\n            return null;\r\n        }\r\n        const username = storage.get('loggedInfo').nickname;\r\n        const thumbnail = storage.get('loggedInfo').thumbnail;\r\n        const {writtenData,hashdisplay,keyid,category,totalNum,commentCategory,PostActions} = this.props;\r\n        const {openWriteModal,overHashTag,outHashTag,handleStateClick,handleLikeClick,enterComment,handleCommentAdd\r\n            ,handleCancelClick,handleComment,handleImage} = this;\r\n        if(writtenData === '') PostActions.setWrittenData(`${username}님, 무슨 일이 있으셨나요?`);\r\n        return(\r\n            <PageWrapper>\r\n            <FeedList mainfeed={data} username = {username} onclick = {openWriteModal} stateclick={handleStateClick} content ={\r\n                writtenData.split('\\n').map( (line,index) => {\r\n            return (<div key={index} style={style} >{line}<br/></div>)\r\n          })}\r\n           hover = {overHashTag} nothover={outHashTag} hashdisplay={hashdisplay} keyid = {keyid} like={handleLikeClick}\r\n         category = {category} cancel={handleCancelClick} totalNum={totalNum} handleComment={handleComment} handleCommentAdd = {handleCommentAdd}\r\n          thumbnail={thumbnail} commentCategory={commentCategory} enterComment={enterComment} handleImage={handleImage}/>\r\n         \r\n            </PageWrapper>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(\r\n    (state) => ({\r\n        writtenData : state.post.get('writtenData'),\r\n        data : state.timeline.get('mainfeed'),\r\n        page : state.timeline.get('page'),\r\n        isTruePost : state.timeline.get('isTruePost'),\r\n        hashdisplay : state.timeline.get('hashdisplay'),\r\n        keyid : state.timeline.get('keyid'),\r\n        category : state.timeline.get('categoryid'),\r\n        totalNum : state.like.get('totalNum'),\r\n        commentList : state.comment.get('commentList'),\r\n        commentNum : state.comment.get('commentNum'),\r\n        commentCategory : state.timeline.get('commentCategory'),\r\n        commentdisplay : state.timeline.get('commentdisplay'),\r\n        postId : state.post.get('postId'),\r\n        presentComment : state.comment.get('presentComment'),\r\n        lastComment : state.comment.get('lastComment')\r\n    }),\r\n    (dispatch) => ({\r\n        TimelineActions: bindActionCreators(timelineActions, dispatch),\r\n        FriendActions: bindActionCreators(friendActions, dispatch),\r\n        SearchActions : bindActionCreators(searchActions,dispatch),\r\n        PostActions : bindActionCreators(postActions,dispatch),\r\n        LikeActions : bindActionCreators(likeActions,dispatch),\r\n        CommentActions : bindActionCreators(commentActions,dispatch)\r\n\r\n    })\r\n)(PostListContainer);"]},"metadata":{},"sourceType":"module"}