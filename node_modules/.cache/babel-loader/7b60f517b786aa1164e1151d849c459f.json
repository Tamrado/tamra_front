{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\user\\\\fronttimeline\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _classCallCheck from\"C:\\\\Users\\\\user\\\\fronttimeline\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\user\\\\fronttimeline\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\user\\\\fronttimeline\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\user\\\\fronttimeline\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"C:\\\\Users\\\\user\\\\fronttimeline\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\user\\\\fronttimeline\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import{List,Map}from'immutable';import React,{Component}from'react';import{connect}from'react-redux';import{WriteBox,ImageList}from'../../components/Post';import{PostPopup,Popup}from'../../components/Popup';import{bindActionCreators}from'redux';import*as postActions from'../../redux/modules/post';import*as searchActions from'../../redux/modules/search';import*as timelineActions from'../../redux/modules/timeline';import storage from'../../lib/storage';import ShowLevelMenu from'../../components/Post/ShowLevelMenu';var WriteBoxContainer=/*#__PURE__*/function(_Component){_inherits(WriteBoxContainer,_Component);function WriteBoxContainer(){var _getPrototypeOf2;var _this;_classCallCheck(this,WriteBoxContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(WriteBoxContainer)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={opacity:0.8,showLevelDisplay:'none',level:'전체 공개'};_this.openShowLevel=function(){_this.setState({showLevelDisplay:'block'});};_this.closeShowLevel=function(){_this.setState({showLevelDisplay:'none'});};_this.handleImageChange=function(e){e.preventDefault();var PostActions=_this.props.PostActions;var reader=new FileReader();var file=e.target.files[0];reader.onloadend=function(){PostActions.setImage({'url':reader.result});PostActions.updateFilelist(file);};try{reader.readAsDataURL(file);}catch(e){_this.setPopupMessage('파일 등록에 실패했습니다. 다시 시도해주세요.');}};_this.handleWriteBox=function(e){var PostActions=_this.props.PostActions;var innerText=e.target.innerText;PostActions.setWrittenData(innerText);};_this.handleScroll=function(e){var scrollTop=e.srcElement.scrollingElement.scrollTop;_this.setState({opacity:0.8-scrollTop/800});if(_this.state.opacity<0){_this.closeWriteModal();_this.props.PostActions.setPopupDisplay('none');_this.props.PostActions.setPostPopupDisplay('none');}};_this.openModal=function(){var _this$props=_this.props,SearchActions=_this$props.SearchActions,PostActions=_this$props.PostActions;PostActions.setDisplay('block');SearchActions.setFriendList(_this.props.friendData);};_this.closeWriteModal=function(){_this.props.PostActions.setWriteDisplay('none');};_this.handleWithBox=function(){var PostActions=_this.props.PostActions;PostActions.setWithFriendDisplay('block');};_this.handleImageCancel=function(e){var PostActions=_this.props.PostActions;var id=e.target.id;PostActions.removeImage(id);};_this.handleShowClick=function(){var showLevelDisplay=_this.state.showLevelDisplay;if(showLevelDisplay==='none')_this.openShowLevel();else _this.closeShowLevel();};_this.handleLevelClick=function(e){var id=e.target.id;var PostActions=_this.props.PostActions;PostActions.setShowLevel({showLevel:id});if(id==='public')_this.setState({level:'전체 공개'});else if(id==='private')_this.setState({level:'나만 보기'});else _this.setState({level:'친구 공개'});_this.closeShowLevel();};_this.handleWriteClickButton=function(){var PostActions=_this.props.PostActions;PostActions.setPostPopupDisplay('block');};_this.handleCancel=function(){var PostActions=_this.props.PostActions;PostActions.setPostPopupDisplay('none');};_this.setPopupMessage=function(text){var PostActions=_this.props.PostActions;PostActions.setPostPopupDisplay('none');PostActions.setPopupDisplay('block');PostActions.setPopupText(text);};_this.handleWriteClick=function _callee(){var _this$props2,PostActions,content,showLevel,friendInfo,filelist,_assertThisInitialize,setPopupMessage,tags,postId;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props2=_this.props,PostActions=_this$props2.PostActions,content=_this$props2.content,showLevel=_this$props2.showLevel,friendInfo=_this$props2.friendInfo,filelist=_this$props2.filelist;_assertThisInitialize=_assertThisInitialized(_this),setPopupMessage=_assertThisInitialize.setPopupMessage;tags=friendInfo.toJS();if(!(content.length>1000)){_context.next=7;break;}console.log('*');setPopupMessage('글은 1000자 이하여야 합니다. 다시 입력해주세요.');return _context.abrupt(\"return\");case 7:if(!(filelist.size>9)){_context.next=10;break;}setPopupMessage('이미지는 9장까지 게시할 수 있습니다.');return _context.abrupt(\"return\");case 10:_context.prev=10;_context.next=13;return _regeneratorRuntime.awrap(PostActions.uploadFeed({content:content,showLevel:showLevel,tags:tags}));case 13:_context.next=20;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](10);if(!(_context.t0.response.status===409)){_context.next=20;break;}setPopupMessage('글은 1000자 이하여야 합니다. 다시 입력해주세요.');return _context.abrupt(\"return\");case 20:postId=_this.props.postId;_context.prev=21;_context.next=24;return _regeneratorRuntime.awrap(filelist.forEach(function(value,index,filelist){var formdata=new FormData();formdata.set('file',value.get('file'));if(postId!==-1&&formdata.get('file')!==null)PostActions.uploadImage(formdata,postId);}));case 24:_context.next=32;break;case 26:_context.prev=26;_context.t1=_context[\"catch\"](21);_context.next=30;return _regeneratorRuntime.awrap(PostActions.deleteFeed(postId));case 30:setPopupMessage('글을 게시하는 데 실패했습니다. 다시 시도해주세요.');return _context.abrupt(\"return\");case 32:PostActions.setDisplay('none');PostActions.setWithFriendDisplay('none');PostActions.setWithDisplay('none');PostActions.setWriteDisplay('none');PostActions.setWrittenData('');document.getElementById('^^content').textContent='';PostActions.initializeFilelist();PostActions.initializeImage();PostActions.setPostPopupDisplay('none');_this.renewMain();case 42:case\"end\":return _context.stop();}}},null,null,[[10,15],[21,26]]);};_this.renewMain=function(){return setTimeout(function _callee2(){var _this$props3,postId,TimelineActions;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props3=_this.props,postId=_this$props3.postId,TimelineActions=_this$props3.TimelineActions;_context2.next=3;return _regeneratorRuntime.awrap(TimelineActions.getFeedInformationDetail(postId));case 3:_context2.next=5;return _regeneratorRuntime.awrap(TimelineActions.renewMainInformation());case 5:case\"end\":return _context2.stop();}}});},4000);};_this.handlePhotoDelete=function _callee3(e){var id,PostActions;return _regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:id=e.target.id;PostActions=_this.props.PostActions;_context3.next=4;return _regeneratorRuntime.awrap(PostActions.deleteFile(id));case 4:case\"end\":return _context3.stop();}}});};_this.handlePopupOk=function(){var PostActions=_this.props.PostActions;PostActions.setPopupDisplay('none');};return _this;}_createClass(WriteBoxContainer,[{key:\"componentDidMount\",value:function componentDidMount(){window.addEventListener(\"scroll\",this.handleScroll);if(!storage.get('loggedInfo'))return;}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){clearTimeout(this.renewMain);}},{key:\"render\",value:function render(){if(!storage.get('loggedInfo')){return null;}var username=storage.get('loggedInfo').nickname;var _this$props4=this.props,images=_this$props4.images,writeDisplay=_this$props4.writeDisplay,withdisplay=_this$props4.withdisplay,withfriend=_this$props4.withfriend,popupDisplay=_this$props4.popupDisplay,postPopupDisplay=_this$props4.postPopupDisplay,popupText=_this$props4.popupText;var _this$state=this.state,opacity=_this$state.opacity,showLevelDisplay=_this$state.showLevelDisplay,level=_this$state.level;var handleImageChange=this.handleImageChange,handleWriteBox=this.handleWriteBox,openModal=this.openModal,closeWriteModal=this.closeWriteModal,handleWithBox=this.handleWithBox,handleImageCancel=this.handleImageCancel,handleLevelClick=this.handleLevelClick,handleShowClick=this.handleShowClick,handleWriteClick=this.handleWriteClick,handlePhotoDelete=this.handlePhotoDelete,handleWriteClickButton=this.handleWriteClickButton,handleCancel=this.handleCancel,handlePopupOk=this.handlePopupOk;return React.createElement(WriteBox,{withdisplay:withdisplay,withclick:handleWithBox,friend:withfriend,username:username,onclick:handleWriteBox,opacity:opacity,click:openModal,display:writeDisplay,close:closeWriteModal,showClick:handleShowClick,showLevel:level,writeClick:handleWriteClickButton},React.createElement(ShowLevelMenu,{showDisplay:showLevelDisplay,onclick:handleLevelClick,top:'59px',left:'800px'}),React.createElement(ImageList,{image:images,cancel:handleImageCancel,change:handleImageChange,handlePhotoDelete:handlePhotoDelete}),React.createElement(Popup,{text:popupText,display:popupDisplay,handlePopupOk:handlePopupOk}),React.createElement(PostPopup,{right:'30%',opacity:opacity,text:'게시하시겠습니까?',fixedDisplay:'block',display:postPopupDisplay,handleOk:handleWriteClick,handleCancel:handleCancel}));}}]);return WriteBoxContainer;}(Component);export default connect(function(state){return{images:state.post.get('image'),withdisplay:state.post.get('withDisplay'),withfriend:state.post.get('withFriend'),isTruePost:state.post.get('isTruePost'),writeDisplay:state.post.get('writeDisplay'),friendData:state.friend.get('friend'),content:state.post.get('writtenData'),showLevel:state.post.get('showLevel'),friendInfo:state.post.get('friendInfo'),postId:state.post.get('postId'),filelist:state.post.get('filelist'),clear:state.post.get('clear'),popupDisplay:state.post.get('popupDisplay'),postPopupDisplay:state.post.get('postPopupDisplay'),popupText:state.post.get('popupText')};},function(dispatch){return{PostActions:bindActionCreators(postActions,dispatch),SearchActions:bindActionCreators(searchActions,dispatch),TimelineActions:bindActionCreators(timelineActions,dispatch)};})(WriteBoxContainer);","map":{"version":3,"sources":["C:/Users/user/fronttimeline/src/containers/Base/WriteBoxContainer.js"],"names":["List","Map","React","Component","connect","WriteBox","ImageList","PostPopup","Popup","bindActionCreators","postActions","searchActions","timelineActions","storage","ShowLevelMenu","WriteBoxContainer","state","opacity","showLevelDisplay","level","openShowLevel","setState","closeShowLevel","handleImageChange","e","preventDefault","PostActions","props","reader","FileReader","file","target","files","onloadend","setImage","result","updateFilelist","readAsDataURL","setPopupMessage","handleWriteBox","innerText","setWrittenData","handleScroll","scrollTop","srcElement","scrollingElement","closeWriteModal","setPopupDisplay","setPostPopupDisplay","openModal","SearchActions","setDisplay","setFriendList","friendData","setWriteDisplay","handleWithBox","setWithFriendDisplay","handleImageCancel","id","removeImage","handleShowClick","handleLevelClick","setShowLevel","showLevel","handleWriteClickButton","handleCancel","text","setPopupText","handleWriteClick","content","friendInfo","filelist","tags","toJS","length","console","log","size","uploadFeed","response","status","postId","forEach","value","index","formdata","FormData","set","get","uploadImage","deleteFeed","setWithDisplay","document","getElementById","textContent","initializeFilelist","initializeImage","renewMain","setTimeout","TimelineActions","getFeedInformationDetail","renewMainInformation","handlePhotoDelete","deleteFile","handlePopupOk","window","addEventListener","clearTimeout","username","nickname","images","writeDisplay","withdisplay","withfriend","popupDisplay","postPopupDisplay","popupText","post","isTruePost","friend","clear","dispatch"],"mappings":"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","sourcesContent":["import { List,Map} from 'immutable';\r\nimport React, {Component} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport {WriteBox,ImageList} from '../../components/Post';\r\nimport {PostPopup,Popup} from '../../components/Popup';\r\nimport {bindActionCreators} from 'redux';\r\nimport * as postActions from '../../redux/modules/post';\r\nimport * as searchActions from '../../redux/modules/search';\r\nimport * as timelineActions from '../../redux/modules/timeline';\r\nimport storage from '../../lib/storage';\r\nimport ShowLevelMenu from '../../components/Post/ShowLevelMenu';\r\n\r\nclass WriteBoxContainer extends Component{\r\n    state  = {\r\n        \r\n        opacity : 0.8,\r\n        showLevelDisplay : 'none',\r\n        level : '전체 공개'\r\n    };\r\n\r\n    openShowLevel = () => {\r\n        this.setState({\r\n            showLevelDisplay : 'block'\r\n        })\r\n    }\r\n    closeShowLevel = () => {\r\n        this.setState({\r\n            showLevelDisplay : 'none'\r\n        })\r\n    }\r\n\r\n    handleImageChange = (e) => {\r\n        e.preventDefault();\r\n        const {PostActions} = this.props;\r\n        let reader = new FileReader();\r\n        let file = e.target.files[0];\r\n        reader.onloadend = () => {\r\n            PostActions.setImage({'url' : reader.result});\r\n            PostActions.updateFilelist(file);\r\n        }\r\n        try{\r\n        reader.readAsDataURL(file);\r\n        }catch(e){\r\n            this.setPopupMessage('파일 등록에 실패했습니다. 다시 시도해주세요.');\r\n        }\r\n      }\r\n\r\n      handleWriteBox = (e) => {\r\n        const {PostActions} = this.props;\r\n        const {innerText} = e.target;\r\n        PostActions.setWrittenData(innerText);\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener(\"scroll\", this.handleScroll);\r\n        if(!storage.get('loggedInfo')) return ;\r\n      }\r\n      handleScroll = (e) => {\r\n        const scrollTop =e.srcElement.scrollingElement.scrollTop;\r\n        \r\n        this.setState({\r\n            opacity : 0.8 - scrollTop / 800\r\n        });\r\n        if(this.state.opacity < 0){\r\n           this.closeWriteModal();\r\n           this.props.PostActions.setPopupDisplay('none');\r\n           this.props.PostActions.setPostPopupDisplay('none');\r\n        }\r\n      }\r\n    \r\n    openModal = () => {\r\n        const{SearchActions,PostActions} = this.props;\r\n        PostActions.setDisplay('block');\r\n        SearchActions.setFriendList(this.props.friendData);\r\n      }\r\n\r\n      closeWriteModal = () => {\r\n        this.props.PostActions.setWriteDisplay('none');\r\n      }\r\n\r\n      handleWithBox = () => {\r\n        const{PostActions} = this.props;\r\n        PostActions.setWithFriendDisplay('block');\r\n    }\r\n\r\n    handleImageCancel = (e) => {\r\n        const{PostActions} = this.props;\r\n        const {id} = e.target;\r\n        PostActions.removeImage(id);\r\n    }\r\n\r\n    handleShowClick = () => {\r\n        const {showLevelDisplay} = this.state;\r\n        if(showLevelDisplay === 'none')this.openShowLevel();\r\n        else this.closeShowLevel();\r\n    }\r\n\r\n    handleLevelClick = (e) => {\r\n        const {id} = e.target;\r\n        const {PostActions} = this.props;\r\n        PostActions.setShowLevel({showLevel : id});\r\n        if(id === 'public') this.setState({\r\n            level : '전체 공개'\r\n        });\r\n        else if(id === 'private') this.setState({\r\n            level : '나만 보기'\r\n        });\r\n        else this.setState({\r\n            level : '친구 공개'\r\n        })\r\n        this.closeShowLevel();\r\n    }\r\n\r\n    handleWriteClickButton = () => {\r\n        const {PostActions} = this.props;\r\n        PostActions.setPostPopupDisplay('block');\r\n    }\r\n    handleCancel = () => {\r\n        const {PostActions} = this.props;\r\n        PostActions.setPostPopupDisplay('none');\r\n    }\r\n    setPopupMessage = (text) => {\r\n        const {PostActions} = this.props;\r\n        PostActions.setPostPopupDisplay('none');\r\n        PostActions.setPopupDisplay('block');\r\n        PostActions.setPopupText(text);\r\n    }\r\n    handleWriteClick = async() => {\r\n        const {PostActions,content,showLevel,friendInfo,filelist} = this.props;\r\n        const {setPopupMessage} = this;\r\n        var tags = friendInfo.toJS();\r\n        if(content.length > 1000){\r\n            console.log('*');\r\n            setPopupMessage('글은 1000자 이하여야 합니다. 다시 입력해주세요.');\r\n            return;\r\n        }\r\n        if(filelist.size > 9){\r\n            setPopupMessage('이미지는 9장까지 게시할 수 있습니다.');\r\n            return;\r\n        }\r\n        try{\r\n        await PostActions.uploadFeed({content,showLevel,tags});\r\n        }catch(e){\r\n            if(e.response.status === 409){\r\n                setPopupMessage('글은 1000자 이하여야 합니다. 다시 입력해주세요.');\r\n                return;\r\n            }\r\n        }\r\n        const {postId} = this.props;\r\n        try{\r\n        await filelist.forEach((value,index,filelist)=>{\r\n                var formdata = new FormData();\r\n                formdata.set('file',value.get('file'));\r\n                if(postId !== -1 && formdata.get('file') !== null)\r\n                    PostActions.uploadImage(formdata,postId);\r\n        });\r\n    }catch(e){\r\n        await PostActions.deleteFeed(postId);\r\n        setPopupMessage('글을 게시하는 데 실패했습니다. 다시 시도해주세요.');\r\n        return;\r\n        }\r\n        PostActions.setDisplay('none');\r\n        PostActions.setWithFriendDisplay('none');\r\n        PostActions.setWithDisplay('none');\r\n        PostActions.setWriteDisplay('none');\r\n        PostActions.setWrittenData('');\r\n        document.getElementById('^^content').textContent = '';\r\n        PostActions.initializeFilelist();\r\n        PostActions.initializeImage();\r\n        PostActions.setPostPopupDisplay('none');\r\n        this.renewMain();\r\n    }\r\n   \r\n    renewMain=()=>\r\n    setTimeout(async()=>{\r\n        const {postId,TimelineActions} = this.props;\r\n        await TimelineActions.getFeedInformationDetail(postId);\r\n        await TimelineActions.renewMainInformation();\r\n    },4000);\r\n    handlePhotoDelete = async(e) =>{\r\n        const {id} = e.target;\r\n        const {PostActions} = this.props;\r\n        await PostActions.deleteFile(id);\r\n    }\r\n    handlePopupOk=()=>{\r\n        const {PostActions} = this.props;\r\n        PostActions.setPopupDisplay('none');\r\n    }\r\n   componentWillUnmount(){\r\n    clearTimeout(this.renewMain);\r\n   }\r\n    render(){\r\n        if(!storage.get('loggedInfo')) {\r\n            \r\n            return null;\r\n        }\r\n        const username = storage.get('loggedInfo').nickname;\r\n        const {images,writeDisplay,withdisplay,withfriend,popupDisplay,postPopupDisplay,popupText} = this.props;\r\n        const {opacity,showLevelDisplay,level} = this.state;\r\n        const {handleImageChange,handleWriteBox,openModal,closeWriteModal,handleWithBox,\r\n            handleImageCancel,handleLevelClick,handleShowClick,handleWriteClick,handlePhotoDelete,\r\n            handleWriteClickButton,handleCancel,handlePopupOk} = this;\r\n        return(\r\n            <WriteBox withdisplay = {withdisplay}  withclick = {handleWithBox} friend = {withfriend} username = {username} \r\n            onclick = {handleWriteBox} opacity = {opacity} click={openModal} display = {writeDisplay} \r\n            close = {closeWriteModal} showClick = {handleShowClick} showLevel={level} writeClick={handleWriteClickButton} >\r\n                <ShowLevelMenu showDisplay = {showLevelDisplay} onclick = {handleLevelClick} top = {'59px'} left = {'800px'}/>\r\n                <ImageList image = {images} cancel = {handleImageCancel} change = {handleImageChange} handlePhotoDelete = {handlePhotoDelete}/>\r\n                <Popup text={popupText} display = {popupDisplay} handlePopupOk={handlePopupOk}/>\r\n                <PostPopup right={'30%'} opacity={opacity} text={'게시하시겠습니까?'} fixedDisplay = {'block'} display = {postPopupDisplay} handleOk={handleWriteClick} handleCancel={handleCancel}/>\r\n                </WriteBox>\r\n        );\r\n    }\r\n\r\n}\r\nexport default connect(\r\n    (state) => ({\r\n        images : state.post.get('image'),\r\n        withdisplay : state.post.get('withDisplay'),\r\n        withfriend : state.post.get('withFriend'),\r\n        isTruePost : state.post.get('isTruePost'),\r\n        writeDisplay : state.post.get('writeDisplay'),\r\n        friendData : state.friend.get('friend'),\r\n        content : state.post.get('writtenData'),\r\n        showLevel : state.post.get('showLevel'),\r\n        friendInfo : state.post.get('friendInfo'),\r\n        postId : state.post.get('postId'),\r\n        filelist : state.post.get('filelist'),\r\n        clear : state.post.get('clear'),\r\n        popupDisplay : state.post.get('popupDisplay'),\r\n        postPopupDisplay : state.post.get('postPopupDisplay'),\r\n        popupText : state.post.get('popupText')\r\n    }),\r\n    (dispatch) => ({\r\n        PostActions: bindActionCreators(postActions, dispatch),\r\n        SearchActions : bindActionCreators(searchActions,dispatch),\r\n        TimelineActions : bindActionCreators(timelineActions,dispatch)\r\n\r\n    })\r\n)(WriteBoxContainer);"]},"metadata":{},"sourceType":"module"}